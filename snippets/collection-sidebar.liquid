<style>
  .advanced-filters{
    display: flex;
    flex-direction: column;
  }
 
</style>


<div class="sidebar-overlay"></div>
<div class="oc-menu" id="sidebar-toggle">
  <input type="hidden" id="menu-effect-{{section.id}}" class="menu-effect" value="none">
  <div class="oc-menu-bar visible-sm visible-xs">
    <div class="text-center">
      <i class="icon-menu" aria-hidden="true"></i>
      <span style="cursor:pointer">{{ 'collections.sidebar.sidebar_filters' | t }}</span>
    </div>
  </div>
</div>
<aside id="column-left" class="col-sm-12 col-md-3">
  <div class="layernavigation-module">
    <div class="panel panel-default">
      {% if page_title != 'Products' %}
        <div class="panel-heading layered-heading">
          {{ page_title }}
        </div>
      {% endif %}
      <div class="layered">
        <div class="list-group">
          <div class="filter-attribute-container filter-attribute-remove-container"></div>
          {% for block in section.blocks %}
            {% if block.type == 'categories' %}
              <!-- Sidebar Categories -->
              <div class="filter-attribute-container filter-categories">
                <label>{{ 'collections.sidebar.categories' | t }}</label>
                <div class="list-group-item">
                  <div id="filter-group0">
                    {% for collection1 in collections limit: block.settings.category_count %}
                      {% unless collection1.handle == 'frontpage' or collection1.handle == 'all' %}
                        <a
                          class="a-filter add-filter {% if collection1.handle == collection.handle %} active {% endif %}"
                          href="{{ collection1.url }}"
                        >
                          {{- collection1.title }} (
                          {{- 'collections.general.items_with_count' | t: count: collection1.all_products_count -}}
                          )</a
                        >
                      {% endunless %}
                    {% endfor %}
                  </div>
                </div>
              </div>
            {% elsif block.type == 'links' %}
              <!-- Shows a link menu selected from settings -->
              {% if block.settings.collection_sidebar_menu != blank %}
                <div class="filter-attribute-container filter-categories">
                  <label>{{ linklists[block.settings.collection_sidebar_menu].title }}</label>
                  <div class="list-group-item">
                    <div id="filter-group0">
                      {% for link in linklists[block.settings.collection_sidebar_menu].links %}
                        <a class="a-filter add-filter {% if link.active %} active {% endif %}" href="{{link.url}}">
                          {{- link.title -}}
                        </a>
                      {% endfor %}
                    </div>
                  </div>
                </div>
              {% endif %}
            {% elsif block.type == 'vendors' %}
              <!-- add the vendor as product tag to product then use this code in collection.liquid -->
              <!-- if we are on a collection page that is either custom or smart -->
              <div class="filter-attribute-container filter-categories">
                {% if block.settings.show_vendors_title %}
                  <label>{{ 'collections.sidebar.vendors' | t }}</label>
                {% endif %}
                <div class="list-group-item">
                  <div id="filter-group0">
                    {% for product_vendor in collection.all_vendors %}
                      {% if current_tags contains product_vendor %}
                        {{ product_vendor | link_to_vendor: class: ' a-filter add-filter active' }}
                      {% else %}
                        {{ product_vendor | link_to_vendor: class: ' a-filter add-filter' }}
                      {% endif %}
                    {% endfor %}
                  </div>
                </div>
              </div>
            {% elsif block.type == 'filters' %}
              {% comment %}
          The code below relies on the advanced-tag-loop snippet.
          The snippet is already included in snippets/breadrumbs.liquid
          because it is needed there too, but if you remove
          breadcrumbs you need to include this:

          {% endcomment %}
          {% include 'advanced-tag-loop' %}

          {% if block.settings.collection_sidebar_filters == 'groups' %}
          {% if collection.all_tags.size > 0 %}
          {% comment %}
          Loop through tag categories
          {% endcomment %}
          {% for cat_item in cat_array %}
          <div class="filter-attribute-container">
            <label class="filter-label">{{ cat_item }}</label>
            <div class="list-group-item">
              <div id="filter-group{{forloop.index}}" class="advanced-filters" data-filter-group="{{ cat_item }}">
                {% comment %}
                Loop through collection tags
                {% endcomment %}
                {% for tag in collection.all_tags %}
                {% assign cat = tag | split: '_' | first %}              
                {% if cat != tag and cat_item == cat %}

                {% comment %}
                Code for adding styling for color boxes
                {% endcomment %}
                {% assign color_class = ''%}
                {% capture color_style %} {%endcapture%}
                {% if section.settings.show_color_box and section.settings.color_box_variant != blank %}
                {% assign color_class = tag | remove_first: cat_item | remove_first: '_' | prepend:'bg-' %} 
                {% capture color_style %}style="background-color:{{ tag | remove_first: cat_item | remove_first: '_' }}"{% endcapture %}
                {% endif %}

                {% comment %}
                Strip out tag category prefix and add/remove link for tag filtering
                {% endcomment %}
                {% if current_tags contains tag %}
                <span class="active-filter {{ color_class }}" >
                  {{ tag | remove_first: cat_item | remove_first: '_' | link_to_remove_tag: tag }}
                </span>
                {% else %}
                <span class="{{ color_class }}" >
                  {{ tag | remove_first: cat_item | remove_first: '_' | link_to_add_tag: tag }}
                </span>
                {% endif %}
                {% endif %}
                {% endfor %}

              </div>
            </div>
          </div>
          {% endfor %}

          {% endif %}
          {% else %}
          <div class="filter-attribute-container">
            <label class="filter-label">{{ 'collections.sidebar.shop_by' | t }}</label>
            <div class="list-group-item">
              <div id="filter-group{{forloop.index}}">
                {% if template contains 'collection' and collection.all_tags.size > 0 %}
                {% comment %}
                Provide a 'catch-all' link at the top of the list,
                we'd check against the collection.handle, product type, and vendor.
                {% endcomment %}
                {% if current_tags %}
                {% comment %}
                Good for /collections/all collection and regular collections
                {% endcomment %}
                {% if collection.handle %}
                <a href="/collections/{{ collection.handle }}">
                  {{ 'collections.sidebar.all' | t }}
                  {% unless collection.title == 'Products' %}
                  {{ collection.title }} ({{ collection.count }})
                  {% endunless %}
                </a>
                {% comment %}
                Good for automatic type collections
                {% endcomment %}
                {% elsif collection.current_type %}
                <a href="{{ collection.current_type | url_for_type }}">{{ 'collections.sidebar.all_collection' | t: collection_title: collection.title }}</a>
                {% comment %}
                Good for automatic vendor collections
                {% endcomment %}
                {% elsif collection.current_vendor %}
                <a href="{{ collection.current_vendor | url_for_vendor }}">{{ 'collections.sidebar.all_collection' | t: collection_title: collection.title }}</a>
                {% endif %}
                {% endif %}
                {% comment %}
                And for the good stuff, loop through the tags themselves.
                Strip the prepended categories if they happen to exist.
                {% endcomment %}
                {% for tag in collection.all_tags %}
                {% assign is_advanced_tag = false %}
                {% assign cat = tag | split: '_' | first %}
                {% unless cat == tag %}
                {% if cat_array contains cat %}
                {% assign is_advanced_tag = true %}
                {% if current_tags contains tag %}
                <span class="active-filter">
                  {{ tag | remove_first: cat | remove_first: '_' }}
                </span>
                {% else %}
                <span>
                  {{ tag | remove_first: cat | remove_first: '_' | link_to_tag: tag }}
                </span>
                {% endif %}
                {% endif %}
                {% endunless %}
                {% if is_advanced_tag == false %}
                {% if current_tags contains tag %}
                {{ tag }}
                {% else %}
                {{ tag | link_to_tag: tag }}
                {% endif %}
                {% endif %}
                {% endfor %}
                {% else %}
                <p>{{ 'collections.sidebar.no_tags' | t }}</p>
                {% endif %}
              </div>
            </div>
          </div>
          {% endif %}
              <div id="side_filter_bar">
                {%- for filter in collection.filters -%}
                  {%- case filter.type -%}
                    {%- when 'list' -%}
                      {% assign flbl = filter.label | handleize %}

                      {% comment %}
                        Code for adding styling for color boxes
                      {% endcomment %}
                      {% capture color_style %} {% endcapture %}
                      {% assign colorbg = false %}
                      {% if section.settings.show_color_box
                        and section.settings.color_box_variant != blank
                        and section.settings.color_box_variant contains flbl
                      %}
                        {% assign colorbg = true %}
                        {% capture color_style %}style="background-color:{{ filter_value.label | prepend: 'bg-' }}"{% endcapture %}
                      {% endif %}

                      <div class="widget {% if colorbg == true %}color_checkbox {{ section.settings.filters_color_design }} {% else %} {{ section.settings.filters_check_design }}{% endif %}  filter-attribute-container ">
                        <label class="title filter-label" id="fp_flbl_dropdown">{{ filter.label }}</label>
                        <form action="#">
                          <ul
                            class=""
                            style="max-height: 15rem;"
                            data-simplebar
                            data-simplebar-auto-hide="false"
                          >
                            {%- for filter_value in filter.values -%}
                              <li
                                {% if colorbg == true -%}
                                  class="d-inline"
                                {%- endif %}
                              >
                                <div class="checkbox_item a-filter add-filter">
                                  <input
                                    type="checkbox"
                                    name="{{ filter_value.param_name }}"
                                    value="{{ filter_value.value }}"
                                    id="Filter-{{ filter.label | escape }}-{{ forloop.index }}"
                                    url_to_add="{{ filter_value.url_to_add }}"
                                    url_to_remove="{{ filter_value.url_to_remove }}"
                                    {% if filter_value.active %}
                                      checked
                                    {% endif %}
                                    title="{{ filter_value.label | escape }}"
                                    {% if filter_value.count == 0 and filter_value.active == false %}
                                      disabled
                                    {% endif %}
                                    class="
                                      form-check-input {% if colorbg == true -%}
                                        {{ filter_value.label | downcase | handleize | prepend: 'bg-' }}
                                      {%- endif -%}
                                    "
                                  >
                                  <label
                                    for="Filter-{{ filter.label | escape }}-{{ forloop.index }}"
                                    {%- if colorbg == true -%}
                                      class="visually-hidden"
                                    {%- endif -%}
                                  >
                                    {{- filter_value.label }}
                                    <span>({{ filter_value.count }})</span></label
                                  >
                                </div>
                              </li>
                            {%- endfor -%}
                          </ul>
                        </form>
                      </div>
                    {%- when 'price_range' -%}
                      <div class="widget pricing_range  filter-attribute-container">
                        <label class="title filter-label" id="fp_{{ filter.label | handleize }}_dropdown">
                          {{ filter.label }}
                        </label>
                        <div id="slider-range" class="slider-range"></div>
                        <div class="price-text d-flex align-items-center">
                          {% comment %} <span>{{ filter.label }}:</span> {% endcomment %}
                          <input
                            class="hidden"
                            name="{{ filter.max_value.param_name }}"
                            id="slider-data"
                            data-currency="{{ cart.currency.symbol }}"
                            readonly
                            url_to_add="{{ filter_value.url_to_add }}"
                            url_to_remove="{{ filter_value.url_to_remove }}"
                            {% if filter.min_value.value -%}
                              data-minn="{{ filter.min_value.value | money_without_currency | replace: ',', '' }}"
                            {% else %}
                              data-minn="0"
                            {%- endif %}
                            {% if filter.max_value.value -%}
                              data-maxx="{{ filter.max_value.value | money_without_currency | replace: ',', '' }}"
                            {% else %}
                              data-maxx="{{ filter.range_max | money_without_currency | replace: ',', '' }}"
                            {%- endif %}
                            type="text"
                            placeholder="{{ filter.range_max | money_without_currency | replace: ',', '' }}"
                            min="0"
                            max="{{ filter.range_max | money_without_currency | replace: ',', '' }}"
                          >
                        </div>
                      </div>
                  {%- endcase -%}
                {%- endfor -%}
              </div>
            {% elsif block.type == '@app' %}
              {% render block %}
            {% elsif block.type == 'image' %}
              <!-- Sidebar image section -->
              {% if block.settings.collection_side_image != blank %}
                <div class="banner-static static-sidebar">
                  <div class="image">
                    <a href="{{ block.settings.collection_side_link }}">
                      <img
                        {% if settings.lazyloading_enable %}
                          class="lazyload" data-
                        {% endif -%}
                        src="{{ block.settings.collection_side_image | image_url }}"
                        alt="{{ block.settings.collection_side_image.alt }}"
                        width="{{ block.settings.collection_side_image.width }}"
                        height="{{ block.settings.collection_side_image.height }}"
                      >
                    </a>
                  </div>
                </div>
              {% endif %}
            {% elsif block.type == 'multi_level_filter' %}
              <div class="filter-attribute-container filter-filters">
                {% if block.settings.heading != blank %}
                  <label class="filter-label">{{ block.settings.heading }}</label>
                {% endif %}
                <div class="list-group-item">
                  <div class="booking-form sidebar">
                    <form>
                      {% assign script_included = false %}
                      <div class="row">
                        {% assign cols = block.settings.no_of_filters | times: 1 %}
                        {% assign total_cols = block.settings.no_of_filters | plus: 1 %}
                        <div class="col-xs-12">
                          <div class="form-group">
                            <label for="filterSel1" class="form-label">
                              {{- block.settings.filter_1_title -}}
                            </label>
                            <select
                              name="optone"
                              id="filterSel1"
                              size="1"
                              placeholder="{{ block.settings.filter_1_title }}"
                              class="form-control"
                              aria-label="{{ block.settings.filter_1_title }}"
                            >
                              <option value="" selected="selected">{{ block.settings.filter_1_title }}</option>
                            </select>
                            <span class="select-arrow"></span>
                          </div>
                        </div>
                        <div class="col-xs-12">
                          <div class="form-group">
                            <label for="filterSel2" class="form-label">
                              {{- block.settings.filter_2_title -}}
                            </label>
                            <select
                              name="opttwo"
                              id="filterSel2"
                              size="1"
                              placeholder="{{ block.settings.filter_2_title }}"
                              class="form-control"
                              aria-label="{{ block.settings.filter_2_title }}"
                            >
                              <option value="" selected="selected">{{ block.settings.filter_2_title }}</option>
                            </select>
                            <span class="select-arrow"></span>
                          </div>
                        </div>
                        {% if cols > 2 %}
                          <div class="col-xs-12">
                            <div class="form-group">
                              <label for="filterSel3" class="form-label">
                                {{- block.settings.filter_3_title -}}
                              </label>
                              <select
                                name="optthree"
                                id="filterSel3"
                                size="1"
                                placeholder="{{ block.settings.filter_3_title }}"
                                class="form-control"
                                aria-label="{{ block.settings.filter_3_title }}"
                              >
                                <option value="" selected="selected">
                                  {{ block.settings.filter_3_title }}
                                </option>
                              </select>
                              <span class="select-arrow"></span>
                            </div>
                          </div>
                        {% endif %}
                        {% if cols > 3 %}
                          <div class="col-xs-12">
                            <div class="form-group">
                              <label for="filterSel4" class="form-label">
                                {{- block.settings.filter_4_title -}}
                              </label>
                              <select
                                name="optfour"
                                id="filterSel4"
                                size="1"
                                placeholder="{{ block.settings.filter_4_title }}"
                                class="form-control"
                                aria-label="{{ block.settings.filter_4_title }}"
                              >
                                <option value="" selected="selected">
                                  {{ block.settings.filter_4_title }}
                                </option>
                              </select>
                              <span class="select-arrow"></span>
                            </div>
                          </div>
                        {% endif %}
                        <div class="col-xs-12">
                          <div class="form-group">
                            <label class="form-label">&nbsp;</label>
                            <div class="form-btn">
                              <button
                                type="button"
                                id="button"
                                class="btn btn-primary w-100 submit-btn"
                                aria-label="{{ 'general.year_make_model.search' | t }}"
                                onclick="window.location.assign(buildUrl('{{ block.id }}', {{ cols }}, '{{ block.settings.filter_type }}'));"
                              >
                                {{ 'general.year_make_model.search' | t }}
                              </button>
                            </div>
                          </div>
                        </div>
                      </div>
                      {% if block.settings.data_source == 'menu' %}
                        <script>
                          let makeObject = {
                            {% for link in linklists[block.settings.menu_handle].links %}
                              "{{- link.title | handleize -}}": {
                                {% for child_link in link.links %}
                                  "{{- child_link.title | handleize -}}": [
                                    {% for grandchild_link in child_link.links %}
                                      "{{- grandchild_link.title | handleize -}}"{% unless forloop.last %},{% endunless %}
                                    {% endfor %}
                                  ]{% unless forloop.last %},{% endunless %}
                                {% endfor %}
                              }{% unless forloop.last %},{% endunless %}
                            {% endfor %}
                          };
                        </script>
                      {% elsif block.settings.data_source == 'file' and script_included == false %}
                        <script src="{{ 'makeObject.js' | asset_url }}" defer></script>
                        {% assign script_included = true %}
                      {% endif %}
                      <script type="text/javascript">
                        // This section creates the dynamic dropdowns
                        document.addEventListener('DOMContentLoaded', (event) => {
                          let filterSel1 = document.getElementById('filterSel1'),
                            filterSel2 = document.getElementById('filterSel2'),
                            filterSel3 = document.getElementById('filterSel3'),
                            filterSel4 = document.getElementById('filterSel4');
                            let dataObject = {% if block.settings.data_source == 'menu' %} makeObject {% else %} {{ block.settings.variable_name }} {% endif %};
                            for (let make in dataObject) {
                            filterSel1.options[filterSel1.options.length] = new Option(make, make);
                          }
                          filterSel1.onchange = function () {
                            filterSel2 ? filterSel2.length = 1 : undefined; // remove all options bar first
                            filterSel3 ? filterSel3.length = 1 : undefined; // remove all options bar first
                            filterSel4 ? filterSel4.length = 1 : undefined; // remove all options bar first
                            if (this.selectedIndex < 1) return;
                            {% if cols > 2 %}
                              for (let model in dataObject[this.value]) {
                                filterSel2.options[filterSel2.options.length] = new Option(model, model);
                              }
                            {% else %}
                            let models = dataObject[this.value];
                            for (let i = 0; i < models.length; i++) {
                              filterSel2.options[filterSel2.options.length] = new Option(models[i], models[i]);
                            }
                          {% endif %}
                          };
                          {% if cols > 2 %}
                          filterSel1.onchange(); // reset in case page is reloaded
                          filterSel2.onchange = function () {
                            filterSel3 ? filterSel3.length = 1 : undefined; // remove all options bar first
                            filterSel4 ? filterSel4.length = 1 : undefined; // remove all options bar first
                            if (this.selectedIndex < 1) return;
                            {% if cols > 3 %}
                              for (let year in dataObject[filterSel1.value][this.value]) {
                                filterSel3.options[filterSel3.options.length] = new Option(year, year);
                              }
                            {% else %}
                            let years = dataObject[filterSel1.value][this.value];
                            for (let i = 0; i < years.length; i++) {
                              filterSel3.options[filterSel3.options.length] = new Option(years[i], years[i]);
                            }
                          {% endif %}
                          };
                        {% endif %}
                          {% if cols > 3 %}
                          filterSel3.onchange = function () {
                            filterSel4 ? filterSel4.length = 1 : undefined; // remove all options bar first
                            if (this.selectedIndex < 1) return;
                            let types = dataObject[filterSel1.value][filterSel2.value][this.value];
                            for (let i = 0; i < types.length; i++) {
                              filterSel4.options[filterSel4.options.length] = new Option(types[i], types[i]);
                            }
                          };
                          {% endif %}
                        });
                      </script>
                    </form>
                  </div>
                  <style>
                    #shopify-section-{{section.id }} .booking-form.sidebar {
                      box-shadow: none;
                      border-radius: unset;
                      padding: 0 0 1.5rem 0;
                      border-bottom: 1px solid #ccc;
                      max-width: unset;
                      background: none;
                    }
                    #shopify-section-{{section.id }} .booking-form.sidebar .form-label {
                      display: none;
                    }
                    @media(min-width: 768px){
                      #shopify-section-{{section.id }} .container-relative {
                        position: relative;
                        width: 100%; /* Full width or any specific width */
                      }
                    }
                    @media(max-width: 991px){
                      #shopify-section-{{section.id }} .booking-form {
                        padding: 20px 10px;
                      }
                      #shopify-section-{{section.id }} .booking-form .form-label {
                        display: none;
                      }
                    }
                      @media(max-width: 767px){
                      #shopify-section-{{section.id }} .booking-form {
                        padding: 40px 10px 10px;
                        margin: 0;
                      }
                      #shopify-section-{{section.id }} .booking-form .form-label {
                        display: none;
                      }
                    }
                    #shopify-section-{{section.id }} .centered-div .booking-form {
                      background-color: rgba(255, 255, 255, 0.5);
                    }
                  </style>
                  <script>
                    function handelize(str) {
                      return str;
                    }
                    // The buildUrl function creates the query string on the values of the IDs in the HTML below
                    function buildUrl(blockId, noOfFilters, filter_type) {
                      let url = ''; // Change this line to your home page URL
                      let qs = '';
                      let filter1 = handelize(document.querySelector(`#filterSel1`).value);
                      if (filter1 && filter_type == 'default') {
                        qs = filter1;
                      } else if (filter1 && filter_type == 'sdapp') {
                        qs = 'filter.p.tag=' + filter1;
                      }
                      let filter2 = handelize(document.querySelector(`#filterSel2`).value);
                      if (filter2 && filter_type == 'default') {
                        qs = filter1 + '+' + filter2;
                      } else if (filter2 && filter_type == 'sdapp') {
                        qs = qs + '&filter.p.tag=' + filter2;
                      }
                      if (noOfFilters > 2) {
                        let filter3 = handelize(document.querySelector(`#filterSel3`).value);
                        if (filter3 && filter_type == 'default') {
                          qs = qs + '+' + filter3;
                        } else if (filter3 && filter_type == 'sdapp') {
                          qs = qs + '&filter.p.tag=' + filter3;
                        }
                      }
                      if (noOfFilters > 3) {
                        let filter4 = handelize(document.querySelector(`#filterSel4`).value);
                        if (filter4 && filter_type == 'default') {
                          qs = qs + '+' + filter4;
                        } else if (filter4 && filter_type == 'sdapp') {
                          qs = qs + '&filter.p.tag=' + filter4;
                        }
                      }
                      if (qs.length > 0) {
                        if (filter_type == 'default') {
                          url = url + '/collections/all/' + qs;
                        } else if (filter_type == 'sdapp') {
                          url = url + '/collections/all?' + qs;
                        }
                      }
                      return url;
                    }

                    document.addEventListener('DOMContentLoaded', function () {
                      // Function to decode the URL part and split it by either a space or a plus sign
                      function decodeAndSplitUrlPart(part) {
                        return decodeURIComponent(part).split(/[\s+]+/);
                      }

                      // Find all select elements within the closest .booking-form class div
                      const bookingForm = document.querySelector('.booking-form.sidebar');
                      const selects = bookingForm.querySelectorAll('select');

                      // Extract the last part of the URL path and split it
                      {% if block.settings.filter_type == 'default' %}
                        const urlPathSegments = window.location.pathname.split('/');
                        const lastSegment = urlPathSegments[urlPathSegments.length - 1];
                        const urlParts = decodeAndSplitUrlPart(lastSegment);
                      {% elsif block.settings.filter_type == 'sdapp' %}
                      const queryParamsSideBar = new URLSearchParams(window.location.search);
                        const urlParts = queryParamsSideBar.getAll('filter.p.tag');
                      {% endif %}

                      // Function to set select value by matching option text
                      function setSelectValue(selectElement, value) {
                        for (let option of selectElement.options) {
                          if (option.text === value) {
                            selectElement.value = option.value;
                            return true; // Value was found and set
                          }
                        }
                        return false; // Value was not found
                      }

                      // Set values and trigger change events sequentially
                      let delay = 0; // Start with no delay
                      urlParts.forEach((part, index) => {
                        if (selects.length > index) {
                          setTimeout(() => {
                            // Use setTimeout to introduce a delay for each iteration
                            if (setSelectValue(selects[index], part)) {
                              selects[index].dispatchEvent(new Event('change'));
                            }
                          }, delay);
                          delay += 300; // Increment delay for subsequent selects to ensure they have time to populate
                        }
                      });
                    });
                  </script>
                </div>
              </div>
            {% endif %}
          {% endfor %}
        </div>
      </div>
    </div>
    <script type="text/javascript">
      $('.filter-attribute-container').find('a').addClass('advanced-filter a-filter add-filter');
      $('#adil').find('a').addClass('active-filter a-filter add-filter');
    </script>
  </div>
</aside>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const customProducts = document.getElementById('custom-products');
    const filterBar = document.getElementById('top_filter_bar');
    const sideFilterBar = document.getElementById('side_filter_bar');
    const sliderRange = document.getElementById('slider-range');
    const activeFilters = document.getElementById('active-filters');

    if ('{{ section.settings.show_pagination_bar }}' == 'false') {
      // Moved repeated DOM queries here
      let next_url = customProducts.dataset.nextUrl;
      const loadMoreBtn = document.querySelector('#more .button span');
      const loadMoreSpinner = document.querySelector('#more .fa-spinner');

      async function getNextPage() {
        try {
          let res = await fetch(next_url, {
            headers: {
              'Cache-Control': 'no-cache',
            },
          });
          return await res.text();
        } catch (error) {
          console.error(error); // Perhaps handle this more gracefully
        }
      }

      async function loadMoreProducts() {
        loadMoreBtn.classList.add('hidden');
        loadMoreSpinner.classList.remove('hidden');
        const nextPage = await getNextPage();

        const parser = new DOMParser();
        const nextPageDoc = parser.parseFromString(nextPage, 'text/html');

        const productGrid = nextPageDoc.getElementById('custom-products');
        const newUrl = productGrid.dataset.nextUrl;
        filterCollParam(next_url, false);
        customProducts.dataset.nextUrl = newUrl;
        next_url = newUrl;
        if (newUrl) {
          setTimeout(function () {
            loadMoreBtn.classList.remove('hidden');
            loadMoreSpinner.classList.add('hidden');
          }, 500);
        } else {
          setTimeout(function () {
            loadMoreBtn.classList.add('hidden'); // Consider if you want to hide or disable the button
            loadMoreSpinner.classList.add('hidden');
          }, 500);
        }
      }
      window.loadMoreProducts = loadMoreProducts;
    }

    document.body.addEventListener('change', function (event) {
      const target = event.target;

      // For filterBar and sideFilterBar
      if (target.matches('input[type=checkbox],input[type=radio]')) {
        event.preventDefault();
        const url = target.checked ? target.getAttribute('url_to_add') : target.getAttribute('url_to_remove');
        filterCollParam(url);
      }
    });

    document.body.addEventListener('click', function (event) {
      const target = event.target;

      // For activeFilters
      if (
        target.matches('.top_popular_tags .tag_item') ||
        target.matches('.top_popular_tags .tag_item span') ||
        target.matches('.top_popular_tags .allclear_btn')
      ) {
        event.preventDefault();
        let url = target.getAttribute('href');
        filterCollParam(url);
      }
      // Check if the target is one of the .filter-attribute-container a elements
      if (target.matches('.filter-attribute-container a.advanced-filter.a-filter.add-filter')) {
        event.preventDefault();
        let url = target.getAttribute('href');
        filterCollParam(url);
      }
      if ('{{ section.settings.show_pagination_bar }}' == 'false') {
        // Check if the clicked element is the #more element
        if (target.matches('#more a span')) {
          loadMoreProducts(event);
        }
      }
    });

    function debounce(func, wait, immediate) {
      let timeout;
      return function () {
        const context = this,
          args = arguments;
        const later = function () {
          timeout = null;
          if (!immediate) func.apply(context, args);
        };
        const callNow = immediate && !timeout;
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
        if (callNow) func.apply(context, args);
      };
    }

    function initSlider() {
      if (document.getElementById('slider-range')) {
        const sliderRange = document.getElementById('slider-range');
        const amount = document.querySelector('#slider-data');
        const minVal = Number(amount.dataset.minn);
        const maxVal = Number(amount.dataset.maxx);
        const maxRange = Number(amount.getAttribute('max'));
        const sliderCurrency = amount.dataset.currency;

        // add nouislider script
        noUiSlider.create(sliderRange, {
          start: [minVal, maxVal],
          connect: true,
          tooltips: true,
          range: {
            min: 0,
            max: maxRange,
          },
        });

        sliderRange.noUiSlider.on('change', function (values, handle) {
          // handle 0 is the left handle, handle 1 is the right handle
          const leftValue = values[0];
          const rightValue = values[1];
          // do something with the values
          const url = document.URL;
          const hasParams = url.indexOf('?') > -1;
          let updatedUrl = '';
          if (hasParams) {
            updatedUrl = replaceUrlParam(url, 'filter.v.price.lte', rightValue);
            updatedUrl = replaceUrlParam(updatedUrl, 'filter.v.price.gte', leftValue);
          } else {
            updatedUrl = `${url}?filter.v.price.lte=${rightValue}&filter.v.price.gte=${leftValue}`;
          }
          filterCollParam(updatedUrl);
        });
      }
    }

    window.initSlider = initSlider;

    initSlider();
  });
</script>
